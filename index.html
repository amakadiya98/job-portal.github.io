<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css" />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/css/bootstrap-select.min.css">
    <!-- <---External css file -->
    <link rel="stylesheet" href="./assets/css/style.css" />
</head>

<body>
    <div class="main">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <form class="project-form" action="result.php" enctype="multipart/form-data" method="post" accept-charset="utf-8">

                        <!-- project creation form -->
                        <div class="form-part specific-project-form">
                            <h3 class="title">Project details</h3>
                            <div class="container-fluid">
                                <div class=" top-space row">
                                    <div class=" space col-lg-6">
                                        <label class="form-txt">Project Title <span class="clr-txt">*</span></label>
                                        <input type="text" name="project_title" required />
                                        <label class="form-txt">Budget<span class="clr-txt">*</span></label>
                                        <input type="number" name="project_budget" required />
                                        <label class="form-txt">Duration<span class="clr-txt"></span></label>
                                        <input type="text" name="project_duration" />
                                        <div>
                                            <label class="form-txt">Sales Team<span class="clr-txt"></span></label>
                                            <select class="form-select plc" aria-label="Default select example" name="project_sales_team">
                                                <option selected class=""> Select Sales Team</option>
                                                <option value="1">One</option>
                                                <option value="2">Two</option>
                                                <option value="3">Three</option>
                                            </select>
                                        </div>
                                        <!-- -- auto suggetion input-- -->
                                        <div class="auto-suggest">
                                            <label class="form-txt">User<span class="clr-txt"></span></label>
                                            <select class="select1" name="project_user_id"></select>
                                        </div>
                                        <!-- -- auto suggetion input-- -->
                                        <!-- Modal -->
                                        <div class="modal fade" id="exampleModal" tabindex="-1"
                                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title title" id="exampleModalLabel">Add User
                                                        </h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="modal-form-part">
                                                            <div class="modal-align">
                                                                <label class="form-txt">Name</label>
                                                                <input type="text" />
                                                                <label class="form-txt">Email</label>
                                                                <input type="email" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary  cus-btn"
                                                            data-bs-dismiss="modal">Cancel</button>
                                                        <button type="button"
                                                            class="btn btn-primary  cus-btn">Add</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space col-lg-6">
                                        <div>
                                            <label class="form-txt">Package<span class="clr-txt"></span></label>
                                            <select class="form-select plc" aria-label="Default select example" name="project_package">
                                                <option selected class="">Select Package</option>
                                                <option value="1">One</option>
                                                <option value="2">Two</option>
                                                <option value="3">Three</option>
                                            </select>
                                        </div>
                                        <label class="form-txt">Deadline<span class="clr-txt">*</span></label>
                                        <input class="plc" type="date" name="project_deadline" required />
                                        <div>
                                            <label class="form-txt">Order ID<span class="clr-txt"></span></label>
                                            <select class="form-select plc" aria-label="Default select example" name="project_order_id">
                                                <option selected class="">Select Order ID</option>
                                                <option value="1">00001</option>
                                                <option value="2">00002</option>
                                                <option value="3">00003</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="form-txt">Assign To<span class="clr-txt"></span></label>
                                            <select class="form-select plc" aria-label="Default select example" name="project_assign_to">
                                                <option selected class="">Select Manager</option>
                                                <option value="1">One</option>
                                                <option value="2">Two</option>
                                                <option value="3">Three</option>
                                            </select>
                                        </div>
                                        <label class="form-txt">Invoice Value<span class="clr-txt"></span></label>
                                        <input type="" name="project_invoice_value" />
                                    </div>
                                    <div class=" space col-lg-12">
                                        <div class="mb-3 text-area">
                                            <label for="exampleFormControlTextarea1" class="form-label form-txt">Project
                                                description <span class="clr-txt">*</span></label>
                                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="project_description"></textarea>
                                        </div>
                                        <div class="chose-file">
                                            <label class="form-txt">Attachment</label>
                                            <div class="chose-btn-align">
                                                <label for="myFiles" class="file-label plc">Choose a file</label>
                                                <input type="file" class="file-input" id="myFiles" name="project_files[]" multiple>
                                                <ul id="fileList">
                                                    <li class="no-of-file form-txt">No file choosen</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!----- job selection form ------->
                        <div id="job_section">
                            <div class="form-part job1">
                                <div class="job-number-title">
                                    <h3 class="title job1">Job</h3>
                                    <button type="button" class="btn job-remove-btn" onclick="return RemoveJobForm(this)">
                                        <img src="./assets/images/minus.png" alt="remove">
                                    </button>
                                </div>
                                <div class="container-fluid">
                                    <div class=" top-space row">
                                        <div class=" space col-lg-6">
                                            <label class="form-txt">Job Title <span class="clr-txt">*</span></label>
                                            <input type="text" name="job_title_1" required />
                                            <label class="form-txt">Budget<span class="clr-txt">*</span></label>
                                            <input class="blank-input" type="number" name="job_budget_1" required />
                                            <div>
                                                <label class="form-txt">Category<span class="clr-txt"></span></label>
                                                <select class="form-select plc" aria-label="Default select example" name="job_category_1">
                                                    <option selected class=""> Select category</option>
                                                    <option value="1">One</option>
                                                    <option value="2">Two</option>
                                                    <option value="3">Three</option>
                                                </select>
                                            </div>
                                            <label class="form-txt">Job Lock Status<span class="clr-txt"></span></label>
                                            <div class="form-txt radio-clr">
                                                <div class="radio-button-yes radio-custom">
                                                    <input class="with-gap" name="job_lock_status_1" type="radio" id="test3" value="1" /> <label class="yes" for="test3">Yes</label>
                                                </div>
                                                <div class="radio-button-no radio-custom">
                                                    <input class="with-gap" name="job_lock_status_1" type="radio" id="test3" value="0" /> <label class="yes" for="test3">No</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class=" space col-lg-6">
                                            <label class="form-txt">Duration<span class="clr-txt"></span></label>
                                            <input type="text" name="job_duration_1" />
                                            <label class="form-txt">Deadline<span class="clr-txt">*</span></label>
                                            <input class="plc" type="date" name="job_deadline_1" required />
                                            <div>
                                                <label class="form-txt">Language<span class="clr-txt"></span></label>
                                                <select class="form-select plc" aria-label="Default select example" name="job_language_1">
                                                    <option selected class=""> Select Language</option>
                                                    <option value="1">One</option>
                                                    <option value="2">Two</option>
                                                    <option value="3">Three</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-txt">Auto Unlock<span class="clr-txt"></span></label>
                                                <select class="form-select plc" aria-label="Default select example" name="job_auto_unlock_1">
                                                    <option selected class="">Select milestone</option>
                                                    <option value="1">One</option>
                                                    <option value="2">Two</option>
                                                    <option value="3">Three</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class=" space col-lg-12">
                                            <div class="mb-3 text-area">
                                                <label for="exampleFormControlTextarea1" class="form-label form-txt">Job detail<span class="clr-txt"></span></label>
                                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="job_description_1"></textarea>
                                            </div>
                                            <div class="chose-file">
                                                <label class="form-txt">Attachment</label>
                                                <div class="chose-btn-align">
                                                    <label for="myFiles1" class="file-label plc">Choose a file</label>
                                                    <input type="file" class="file-input" id="myFiles1" name="job_files_1[]" multiple onchange="onChange(1)">
                                                    <ul id="fileList1">
                                                        <li class="no-of-file form-txt">No file choosen</li>
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- submit job-form button -->
                        <div class="submit-btn-part">
                            <div class="row">
                                <div class="col-12">
                                    <button type="button" class="plus-btn w-100 mt-2" onclick="return AddJobForm();"><img alt="plus-btn" src="./assets/images/plus.svg" />
                                    </button>
                                </div>
                            </div>

                        </div>
                        <!-- create project button -->
                        <div class="create-button">
                            <button class="submit-btn">Create Project</button>
                        </div>


                        <!-- --- job 1 section ----- -->
                    </form>
                </div>
            </div>
        </div>
    </div>




    <script src="./assets/Js/bootstrap.bundle.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/js/bootstrap-select.min.js"></script>

    <!-- (Optional) Latest compiled and minified JavaScript translation files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/js/i18n/defaults-*.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/js/select2.min.js"></script>
    <script>

        var data = [{
            id: 0,
            text: '<div style="color:#78808A">Aditya Vikram</div>',
            html: `<div class="user-div"><div class='user-img'><img src='assets/images/user1.png' alt='user-pic'/></div><div class='user-info'><p>Aditya Vikram</p><span>example@gmail.com</span></div></div>`,
            title: 'Aditya Vikram'
        }, {
            id: 1,
            text: '<div style="color:#78808A">Adil</div>',
            html: `<div id="someId" class="user-div"><div class='user-img'><img src='assets/images/user2.png' alt='user-pic'/></div><div class='user-info'><p>Adil</p><span>example@gmail.com</span></div></div>`,
            title: 'Adil'
        }, {
            id: null,
            text: '<div style="color:#78808A">Create New</div>',
            html: `<button type="button" data-bs-target="#exampleModal" data-bs-toggle="modal" class="btn cus-btn" onClick="changeId()"  id="addEventsButton">Add user</button>`,
            title: 'Create New'
        }];


        let changeId = () => {
            console.log("Clicked")
            $(".select1").select2("close")

        }



        $(".select1").select2({
            data: data,
            escapeMarkup: function (markup) {
                return markup;
            },
            templateResult: function (data) {
                return data.html;
            },
            templateSelection: function (data) {
                return data.text;
            },
            matcher: matcher
        });






        function matcher(params, data) {
            // If there are no search terms, return all of the data
            if ($.trim(params.term) === '' || data.id === null) {
                return data;
            }

            // Do not display the item if there is no 'text' property
            if (typeof data.text === 'undefined') {
                return null;
            }

            // `params.term` should be the term that is used for searching
            // `data.text` is the text that is displayed for the data object
            // `data.html` is the additional / info text, within the option, seen once the dropdown is shown
            // The search is case insensitive
            if (data.text.toLowerCase().indexOf(params.term.toLowerCase()) > -1 || (typeof data.html !== 'undefined' && data.html.toLowerCase().indexOf(params.term.toLowerCase()) > -1)) {
                var modifiedData = $.extend({}, data, true);
                modifiedData.text += ' (matched)';

                // You can return modified objects from here
                // This includes matching the `children` how you want in nested data sets
                console.log(modifiedData, ' <--- I am modified data...')
                return modifiedData;
            }

            // Return `null` if the term should not be displayed
            return null;
        }

        function setFilesToTheList(selectedFiles) {
            const fileThis = $('#myFiles').get(0);
            var fileList = $('#fileList');
            fileList.empty();
            for (var i = 0; i < selectedFiles.length; i++) {
                var listItem = $('<li>');
                var fileName = $('<span>', { text: selectedFiles[i].name });
                var removeButton = $('<button>', { class: 'remove-button', id: i });
                removeButton.on('click', function (e) {
                    e.preventDefault()
                    const dt = new DataTransfer();
                    let files = [...fileThis.files]
                    files.splice(parseInt($(this).attr('id')), 1)
                    for(let file of files) {
                        dt.items.add(file)
                    }
                    fileThis.files = dt.files
                    setFilesToTheList(fileThis.files)
                    console.log(fileThis.files, ' <== updated file set')
                });
                listItem.append(fileName, removeButton);
                fileList.append(listItem);
            }
        }

        $('#myFiles').on('change', function () {
            var selectedFiles = $(this).get(0).files;
            setFilesToTheList(selectedFiles)
        });


        function setFilesToTheList2(selectedFiles, index) {
            const fileThis = $('.file-input').get(index);
            var fileList = $('#fileList'+index);
            fileList.empty();
            for (var i = 0; i < selectedFiles.length; i++) {
                var listItem = $('<li>');
                var fileName = $('<span>', { text: selectedFiles[i].name });
                var removeButton = $('<button>', { class: 'remove-button', id: `${index}_${i}` });
                removeButton.on('click', function (e) {
                    e.preventDefault()
                    const dt = new DataTransfer();
                    let files = [...fileThis.files]
                    files.splice(parseInt($(this).attr('id').split('_')[1]), 1)
                    for(let file of files) {
                        dt.items.add(file)
                    }
                    fileThis.files = dt.files
                    setFilesToTheList2(fileThis.files, index)
                    console.log(fileThis.files, ' <== updated file set')
                });
                listItem.append(fileName, removeButton);
                fileList.append(listItem);
            }
        }

        // $('#myFiles2').on('change', function () {
        //     var selectedFiles = $(this).get(0).files;
        //     setFilesToTheList2(selectedFiles)
        // });

        function onChange (index) {
            console.log(index, ' <=== selected files..')
            var selectedFiles = $('#myFiles'+index).get(0).files;
            setFilesToTheList2(selectedFiles, index)
        }

        var JobID = 1;
        function AddJobForm(){
            JobID++;
            var JobFormContent = `<div id="main_job" class="form-part job1">
                                    <div class="job-number-title">
                                        <h3 class="title job1">Job</h3>
                                        <button type="button" class="btn job-remove-btn" onclick="return RemoveJobForm(this)">
                                            <img src="./assets/images/minus.png" alt="remove">
                                        </button>
                                    </div>
                                    <div class="container-fluid">
                                        <div class=" top-space row">
                                            <div class=" space col-lg-6">
                                                <label class="form-txt">Job Title <span class="clr-txt">*</span></label>
                                                <input type="text" name="job_title_`+JobID+`" required />
                                                <label class="form-txt">Budget<span class="clr-txt">*</span></label>
                                                <input class="blank-input" type="number" name="job_budget_`+JobID+`" required />
                                                <div>
                                                    <label class="form-txt">Category<span class="clr-txt"></span></label>
                                                    <select class="form-select plc" aria-label="Default select example" name="job_category_`+JobID+`">
                                                        <option selected class=""> Select category</option>
                                                        <option value="1">One</option>
                                                        <option value="2">Two</option>
                                                        <option value="3">Three</option>
                                                    </select>
                                                </div>
                                                <label class="form-txt">Job Lock Status<span class="clr-txt"></span></label>
                                                <div class="form-txt radio-clr">
                                                    <div class="radio-button-yes radio-custom">
                                                        <input class="with-gap" name="job_lock_status_`+JobID+`" type="radio" id="test3" value="1" /> <label class="yes" for="test3">Yes</label>
                                                    </div>
                                                    <div class="radio-button-no radio-custom">
                                                        <input class="with-gap" name="job_lock_status_`+JobID+`" type="radio" id="test3" value="0" /> <label class="yes" for="test3">No</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class=" space col-lg-6">
                                                <label class="form-txt">Duration<span class="clr-txt"></span></label>
                                                <input type="text" name="job_duration_`+JobID+`" />
                                                <label class="form-txt">Deadline<span class="clr-txt">*</span></label>
                                                <input class="plc" type="date" name="job_deadline_`+JobID+`" required />
                                                <div>
                                                    <label class="form-txt">Language<span class="clr-txt"></span></label>
                                                    <select class="form-select plc" aria-label="Default select example" name="job_language_`+JobID+`">
                                                        <option selected class=""> Select Language</option>
                                                        <option value="1">One</option>
                                                        <option value="2">Two</option>
                                                        <option value="3">Three</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="form-txt">Auto Unlock<span class="clr-txt"></span></label>
                                                    <select class="form-select plc" aria-label="Default select example" name="job_auto_unlock_`+JobID+`">
                                                        <option selected class="">Select milestone</option>
                                                        <option value="1">One</option>
                                                        <option value="2">Two</option>
                                                        <option value="3">Three</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class=" space col-lg-12">
                                                <div class="mb-3 text-area">
                                                    <label for="exampleFormControlTextarea1" class="form-label form-txt">Job detail<span class="clr-txt"></span></label>
                                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" name="job_description_`+JobID+`"></textarea>
                                                </div>
                                                <div class="chose-file">
                                                    <label class="form-txt">Attachment</label>
                                                    <div class="chose-btn-align">
                                                        <label for="myFiles`+JobID+`" class="file-label plc">Choose a file</label>
                                                        <input type="file" class="file-input" id="myFiles`+JobID+`" name="job_files_`+JobID+`[]" multiple onchange="onChange(`+ JobID +`)">
                                                        <ul id="fileList`+JobID+`">
                                                            <li class="no-of-file form-txt">No file choosen</li>
                                                        </ul>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
            $( "#job_section" ).append(JobFormContent);
            return false;
        }

        function RemoveJobForm(e){
            $(e).parent().parent().remove()
        }

    </script>
</body>

</html>